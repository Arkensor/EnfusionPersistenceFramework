# Respawn system integration
The integration into the respawn system is the most planning-intensive. How the first spawn and the following respawns of players should work can vary a lot per game mode which is the framework does not offer one all-in-one solution like it does for other things. Depending on feedback and experiences gained as to what the common requirements to a respawn system are - and following the vanilla respawn system rework in Arma Reforger update 0.9.9 there can be some more re-useable base classes added to make this step easier. For now, only one respawn system "template" exists that is mean for a single character with a single default loadout prefab and no faction association. A similar multi-character setup can be found in one of the open-source projects using this framework [`EveronLife:Spawning`](https://github.com/EveronLife/EveronLife/tree/main/src/Scripts/Game/Feature/Character/Spawning).

## Single character example respawn system
See [`EPF_RespawnSytemComponent`](https://enfusionengine.com/api/redirect?to=enfusion://ScriptEditor/Scripts/Game/RespawnSystem/EPF_RespawnSytemComponent.c;9) and [`EPF_RespawnHandlerComponent`](https://enfusionengine.com/api/redirect?to=enfusion://ScriptEditor/Scripts/Game/RespawnSystem/EPF_RespawnHandlerComponent.c;6) for how the bohemia UID is handled and the character spawn process awaits finishing of loading before handing over controls to the player.

## Dead body handling
By default the `Self Spawn` option in [`Character_Base.et`](https://enfusionengine.com/api/redirect?to=enfusion://ResourceManager/~EnfusionPersistenceFramework:Prefabs/Characters/Core/Character_Base.et) is disabled. This is so that normal player characters do not automatically spawn even if their controlling person is not connected to the server. To still get dead bodies to spawn the example respawn system above uses the intended method for this which is to catch the [`BaseGameMode.OnPlayerKilled()`](https://enfusionengine.com/api/redirect?to=enfusion://ScriptEditor/Scripts/Game/generated/GameMode/BaseGameMode.c;77) event and force spawn the dead body for the next restart. The garbage manager lifetime persistence info will take care of removing it again after the restart once the configured decay is reached.

Alternatively, it is of course possible to just override the prefab in a game mode mod, enable `Self Spawn` for everybody again and have all the characters spawn back if that is what the gameplay desires. That allows players to kill others who still need to connect. In this case on player reconnect instead of attempting to spawn the joined players character again - because it is already spawned - use `EPF_PersistenceManager.FindEntityByPersistentId()` to get the `IEntity` that belongs to the player and hand out from the respawn system (return value of [`RespawnSystemComponent.RequestSpawn()`](https://enfusionengine.com/api/redirect?to=enfusion://ScriptEditor/Scripts/Game/generated/GameMode/RespawnSystemComponent.c;42) in Arma Reforger versions < 0.9.9). If the character was killed a replacement was maybe already spawned with the new id, depending on how the system is implemented, otherwise, that needs to be taken care of then.

### Persistent id handover
One design aspect to keep in mind is how to handle persistent ids. For convenience, it might make sense to keep the same id for the real player so that associated data in the DB is not tied to the dead body (e.g. level info, logs, playtime statistics, etc). Either the Bohemia UID is put onto the character or a generated id is transferred over to the new body each time. This is how its done in the example respawn system on [`these lines`](https://enfusionengine.com/api/redirect?to=enfusion://ScriptEditor/Scripts/Game/RespawnSystem/EPF_RespawnHandlerComponent.c;73).
